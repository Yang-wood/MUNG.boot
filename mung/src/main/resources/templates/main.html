<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
	    <meta charset="UTF-8" />
	    <title>CODEIT 메인</title>
	    <meta name="viewport" content="width=device-width, initial-scale=1" />
	    
	    <link th:href="@{/css/basic.css}" rel="stylesheet" />
	    
	    <link th:if="${currentUri != '/member/mypage'}" 
	    	  th:href="@{/css/codeit.css}" rel="stylesheet" />
	    
	    <link th:if="${currentUri == '/member/mypage'}"
	    	  th:href="@{/css/mypage.css}" rel="stylesheet" />
	    	  
	    <script th:src="@{/jquery/jquery-3.7.1.js}"></script>
	    <style>
body {
    margin: 0;
    padding: 0;
    font-family: 'Noto Sans KR', sans-serif;
}

header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 64px;
    padding: 0 24px;
    background: rgba(255, 255, 255, 0.95);
    border-bottom: 1px solid #eee;
    position: fixed;
    top: 0; left: 0; right: 0;
    z-index: 1000;
}

.logo {
    font-size: 20px;
    font-weight: bold;
    color: #1f2d3d;
    text-decoration: none;
}

.top-menu {
    display: flex;
    gap: 16px;
    font-size: 14px;
}

.top-menu a {
    text-decoration: none;
    color: #333;
}

header a {
    text-decoration: none;
    color: #333;
}
body {
			background: white;
		}
		
		.book-item {
			border-bottom: 1px solid #e0e0e0;
			padding: 20px 0;
		}
		
		.book-cover {
			width: 120px;
			height: auto;
			object-fit: contain;
		}
		
		.book-info {
		    flex-grow: 1;
		    padding-left: 20px;
		}
		
		.book-buttons {
		       min-width: 150px;
		       display: flex;
		       flex-direction: column;
		       align-items: flex-end;
		       gap: 8px;
		}
		   
		.point-text {
		 		white-space: nowrap;
		 		text-align: right;
				width: 100%;
		 		font-size: 0.9rem;
		 		color: #555;
		}
		
		.book-title {
		       font-size: 1.2rem;
		       font-weight: 600;
		       color: #333;
		}
		
		.book-description {
		      font-size: 0.9rem;
		       color: #555;
		       margin-top: 0.5rem;
		}
		
		.btn-sm {
		       margin-top: 5px;
		       width: 100%;
		}
		</style>
	    
	</head>
	<body>
	
	<header>
	    <a th:href="@{/codeit}" class="logo">CODEIT</a>
	    
	    <!-- 로그인하지 않은 경우 -->
	    <div th:if="${session.member == null and session.admin == null}">
	    <nav class="top-menu">
	        <a th:href="@{/member/login}">로그인</a>
	        <a th:href="@{/member/register}">회원가입</a>
	    </nav>
	    </div>
	    
	    <!-- 일반 회원이 로그인한 경우 -->
	    <div th:if="${session.member != null}">
	    	<span th:text="${session.member.memberName}">회원이름</span>님 환영합니다!
	    	<a th:href="@{/member/mypage}">마이페이지</a>
	    	<a th:href="@{/member/logout}">로그아웃</a>
	    </div>
	    
	    <!-- 관리자가 로그인한 경우 -->
	    <div th:if="${session.admin != null}">
	    	<span th:text="${session.admin.adminName}">관리자</span>님 환영합니다!
	    	<a th:href="@{/admin/dashboard}">관리자페이지</a>
	    	<a th:href="@{/admin/logout}">로그아웃</a>
	    </div>
	    
	</header>
	
	<div class="container">
	    <div class="sub-header" style="height: 64px;">
    	<!-- 결제 선택 모달 -->
	    <div id="bookPaySelModal" class="modal fade" tabindex="-1" role="dialog"
	    data-backdrop="static" data-keyboard="false" aria-labelledby="modallabel">
	    	<div class="modal-dialog">
	    		<div class="modal-content">
	    			<div class="modal-header">
	    					<button type="button" class="btn-close" data-dismiss="modal"></button>
	      					<h6 class="modal-title" id="modallabel">결제 방식을 선택하세요</h6>
	    			</div>
	    			<div class="modal-boby text-center">
	    				<button class="btn btn-primary" id="bookUserPoint">포인트</button>
	    				<button class="btn btn-primary" id="bookCouponPoint">쿠폰</button>
	    			</div>
	    			<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
					</div>
	    		</div>
	    	</div>
	    </div>
	    
	    <!-- 결제 승인 모달 -->
	    <div id="bookPayConfirmModal" class="modal fade" tabindex="-1" role="dialog"
	    data-backdrop="static" data-keyboard="false" aria-labelledby="modallabel2">
	    	<div class="modal-dialog">
	    		<div class="modal-content">
	    			<div class="modal-header">
	    					<button type="button" class="btn-close" data-dismiss="modal"></button>
	      					<h4 class="modal-title" id="modallabel">결제 확인</h4>
	    			</div>
	    			<div class="modal-boby text-center" id="bookPayment">
	    			</div>
	    			<div class="modal-footer">
	    				<button class="btn btn-success" id="bookPaymentBtn">결제하기</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
					</div>
	    		</div>
	    	</div>
	    </div>
    </div>
    
    <div class="main-content">
   		<div class="container py-4">
			        <form class="mb-4 mt-5" method="get" action="/book/search" id="searchForm">
			            <div class="row g-2 align-items-end justify-content-center">
			                <div class="col-md-2">
			                    <select id="searchType" name="type" class="form-select">
			                        <option value="all" th:selected="${type == 'all'}">통합검색</option>
			                        <option value="title" th:selected="${type == 'title'}">제목</option>
			                        <option value="author" th:selected="${type == 'author'}">작가</option>
			                        <option value="category" th:selected="${type == 'category'}">카테고리</option>
			                        <option value="point" th:selected="${type == 'point'}">포인트</option>
			                    </select>
			                </div>
			                <div class="col-md-6">
			                    <input type="text" id="keyword" name="keyword" class="form-control" th:value="${keyword}"> </div>
			                <div class="col-md-2">
			                    <button type="submit" class="btn btn-primary">검색</button>
			                </div>
			            </div>
						<div class="row g-2 align-items-end justify-content-end mt-2">
							<div class="col-md-1 offset-md-8">
								<select id="pageSize" name="size" class="form-select">
									<option value="10" th:selected="${page.size == 10}">10개</option>
									<option value="20" th:selected="${page.size == 20}">20개</option>
									<option value="30" th:selected="${page.size == 30}">30개</option>
									<option value="50" th:selected="${page.size == 50}">50개</option>
								</select>
							</div>
						</div>
			        </form>
					
			        <hr>
			
			        <div id="bookListContainer">
			            <div th:if="${#lists.isEmpty(books)}" class="text-center text-muted mt-5">
			                <p>검색 결과가 없습니다.</p>
			            </div>
			            <div th:each="book : ${books}" class="book-item d-flex align-items-start">
			                <img th:src="${book.coverImage}" alt="표지" class="book-cover">
			                <div class="book-info">
			                    <div class="book-title" th:text="${book.title}">도서 제목</div>
			                    <div class="text-muted mb-1">
			                        저자 : <span th:text="${book.author}">저자</span> |
			                        출판사 : <span th:text="${book.publisher}">출판사</span>
			                    </div>
			                    <div class="book-description" th:text="${book.description}">
			                        도서 설명
			                    </div>
			                </div>
			                <div class="book-buttons">
			                	<button th:if="${book.wishedByCurrentUser}" 
			                    		th:data-book-id="${book.bookId}"
			                    		class="btn btn-primary wishBtn">♥</button>
			                    <button th:if="${!book.wishedByCurrentUser}" 
			                    		th:data-book-id="${book.bookId}"
			                    		class="btn btn-outline-primary wishBtn">♡</button>
			                    
			                    <a th:if="${book.rentedByCurrentUser}"
			                       th:href="@{/book/epubRead(bookId=${book.bookId})}" class="btn btn-primary read-button">열람하기</a>
			                    
			                    <button th:if="${!book.rentedByCurrentUser}" 
			                    		th:data-book-id="${book.bookId}"
			                    		class="btn btn-success rentBtn">대여하기</button>
			                    <div class="point-text">필요 포인트 : <span th:text="${book.rentPoint}">요구 포인트</span></div>
			                </div>
			            </div>
			        </div>
				
				    <div class="mt-4 text-center" th:if="${page.totalPages > 1}">
				        <nav>
				            <ul class="pagination justify-content-center">
				                <li class="page-item" th:if="${!page.first}">
				                    <a class="page-link"
				                       th:href="@{/book/search(page=0, type=${type}, keyword=${keyword}, point=${point}, size=${page.size})}"
				                       tabindex="-1">&lt;&lt;</a>
				                </li>
				                <li class="page-item" th:if="${!page.first}">
				                    <a class="page-link"
				                       th:href="@{/book/search(page=${page.number - 1}, type=${type}, keyword=${keyword}, point=${point}, size=${page.size})}"
				                       tabindex="-1">&lt;</a>
				                </li>
				                <li th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
				                    th:classappend="${i} == ${page.number} ? 'active'" class="page-item">
				                    <a class="page-link"
				                       th:href="@{/book/search(page=${i}, type=${type}, keyword=${keyword}, point=${point}, size=${page.size})}"
				                       th:text="${i + 1}">1</a>
				                </li>
				                <li class="page-item" th:if="${!page.last}">
				                    <a class="page-link"
				                       th:href="@{/book/search(page=${page.number + 1}, type=${type}, keyword=${keyword}, point=${point}, size=${page.size})}"
				                       tabindex="-1">&gt;</a>
				                </li>
				                <li class="page-item" th:if="${!page.last}">
				                    <a class="page-link"
				                       th:href="@{/book/search(page=${page.totalPages - 1}, type=${type}, keyword=${keyword}, point=${point}, size=${page.size})}"
				                       tabindex="-1">&gt;&gt;</a>
				                </li>
				            </ul>
				        </nav>
				    </div>
				</div>
    </div>
	</div>
	
	</body>
</html>